
У нас есть сервер в котором 2 диска: /dev/sda и /dev/sdb. Эти диски собраны у нас в софтверный RAID1 с помощью mdadm. Один
из дисков вышел из строя (или скоро выйдет) пусть это будет /dev/sdb к примеру. Если диск еще не окончательно умер хорошо 
бы зарание переписать с него grub. В случае если диск еще жив выполните команду:
dd if=/dev/sdb bs=512 count=1 | xxd | grep -i grub

вывод ее будет примерно такой:
1+0 records in
1+0 records out
512 bytes (512 B) copied, 9.6803e-05 s, 5.3 MB/s
0000170: be94 7de8 2e00 cd18 ebfe 4752 5542 2000  ..}.......GRUB .

Если на диске grub не установлен последней строки в выводе не будет.
Хорошо бы проверить так же что загрузчик установлен на /dev/sda. Если загрузчик установлен только на диске, который мы будем менять (/dev/sdb), его сразу лучше склонировать на второй диск. 

# grub-install /dev/sdа

Перед заменой диска желательно убрать диск из массива. Для начала проверим как размечен диск в массиве:
# cat /proc/mdstat 
Personalities : [raid1] [raid0] [raid6] [raid5] [raid4] 
md2 : active raid1 sda4[0] sdb4[1]
      1456504640 blocks super 1.2 [2/2] [UU]
      
md1 : active raid1 sda3[0] sdb3[1]
      7996352 blocks super 1.2 [2/2] [UU]
      
md0 : active raid1 sda2[0] sdb2[1]
      499392 blocks super 1.2 [2/2] [UU]
      
unused devices: <none>
Ну или 
# lsblk

В данном случае массив собран так. Что md0 состоит из sda2 и sdb2, md1 из sda3 и sdb3, md2 из sda4 и sdb4. На этом 
сервере md0 это /boot, md1 — своп, md2 — корень. Убираем sdb из всех устройств.

# mdadm /dev/md0 --remove /dev/sdb2
# mdadm /dev/md1 --remove /dev/sdb3
# mdadm /dev/md2 --remove /dev/sdb4

Если разделы из массива не удаляются, это как в нашем случае. Mdadm не считает диск неисправным и использует его, и 
при удалении мы увидим ошибку, что устройство используется. В этом случае перед удалением помечаем диск как сбойный.

# mdadm /dev/md0 -f /dev/sdb2
# mdadm /dev/md1 -f /dev/sdb3
# mdadm /dev/md2 -f /dev/sdb4

А затем снова выполним команды по удалению разделов из массива. Все, мы удалили сбойный диск из массива. Теперь можем 
писать в датацентр запрос на замену диска.
(посмотреть серийник можно так: # smartctl -i /dev/sdb | grep Serial)
Перенос таблицы разделов на новый диск:
После замены поврежденного диска нужно добавить новый диск в RAID массив. Что бы определить какая у нас таблица 
разделов: GPT или MBR можем использовать gdisk 

# apt-get install gdisk -y

Выполняем:

# gdisk -l /dev/sda
Где /dev/sda — старый диск находящийся в raid. В выводе будет примерно это для MBR:
Partition table scan:
MBR: MBR only
BSD: not present
APM: not present
GPT: not present

И примерно это для GPT:
Partition table scan:
MBR: protective
BSD: not present
APM: not present
GPT: present

Перед добавлением диска в массив на нем нужно создать разделы в точности такие же как и  на sda. В зависимости 
от разметки диска это делается по разному.
Копирование разметки для GPT:

# sgdisk -R /dev/НОВЫЙ ДИСК /dev/СТАРЫЙ ДИСК

ВНИМАНИЕ. Первым пишется диск на который копируется разметка, а вторым с которого копируют. Если перепутать их 
местами, то разметка на изначально исправном диске будет уничтожена.
Даем диску новый случайный UIDD:

# sgdisk -G /dev/sdb

Копирование разметки для MBR:

# sfdisk -d /dev/СТАРЫЙ ДИСК | sfdisk /dev/НОВЫЙ ДИСК

ВНИМАНИЕ первым пишется диск с которого переносим разметку, а вторым на который переносим. Если разделы не видны в 
системе, то можно перечитать таблицу разделов командой:

# sfdisk -R /dev/sdb

теперь можно добавлять диск в массив.

# mdadm /dev/md0 -a /dev/sdb2
# mdadm /dev/md1 -a /dev/sdb3
# mdadm /dev/md2 -a /dev/sdb4

После добавления диска в массив нужно установить на него загрузчик. Если сервер загружен в нормальном режиме, то 
это делается одной командой:

# grub-install /dev/sdb

и проверяем, что все ок:

# dd if=/dev/sdb bs=512 count=1 | xxd | grep -i grub

Если сервер загружен в recovery или rescue, то установка загрузчика выглядит следующим образом.
Монтируем корневую файловую систему в  /mnt:

# mount /dev/md2 /mnt

Монтируем boot:

# mount /dev/md0 /mnt/boot

Монтируем /dev, /proc и /sys:

# mount --bind /dev /mnt/dev
# mount --bind /proc /mnt/proc
# mount --bind /sys  /mnt/sys

Затем делаем chroot в примонтированную систему:

# chroot /mnt

И устанавливаем grub на sdb:

# grub-install /dev/sdb

Проверяем, что загружчик установлен и ребутим сервер в нормальный режим.
